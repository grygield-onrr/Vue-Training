<!DOCTYPE html>
<html>
  <head>
    <title>To-Do List</title>
    <script src="https://unpkg.com/vue"></script>
  </head>

  <body>
    <div id="app">
      <h3>To-Do List</h3>
      <p>Filter: <input v-model="itemFilter" /></p>
      <ol>
        <li v-for="(item, id) in filteredItems">
          <button v-if="!item.edit" v-on:click="setItemEditable(item)">
            Edit</button
          ><button v-if="!item.edit" v-on:click="deleteItem(item)">
            Remove
          </button>
          <label v-if="!item.edit">{{ item.text }}</label>
          <button v-if="item.edit" v-on:click="editItem(postEdit, id)">
            Save
          </button>
          <input
            v-if="item.edit"
            v-model="item.text"
            v-focus
            v-on:blur="resetEdit(item)"
            v-on:keyup.enter="
          editItem(item.text, id)"
          />
        </li>
      </ol>
      <p>
        {{ clearLabel }}<br />
        <input v-model="newItem" v-on:keyup.enter="addItem" /><button
          v-on:click="addItem"
        >
          Add Item
        </button>
      </p>
      <p>Total Items: {{ itemTotal }}</p>
      <p>Filtered Items: {{ filteredTotal }}</p>
    </div>

    <script>
      var app = new Vue({
        el: "#app",
        data: {
          todos: [
            { text: "Learn JavaScript", id: 0, edit: false },
            { text: "Learn Vue", id: 1, edit: false },
            { text: "Build something awesome", id: 2, edit: false },
          ],
          newItem: "",
          preEdit: "",
          postEdit: "",
          itemFilter: "",
          clearLabel:
            'Use the box below to add new list items, or type "Clear" to clear out the current list.',
        },
        computed: {
          filteredItems: function () {
            if (this.itemFilter !== "") {
              return this.todos.filter(f =>
                f.text.toLowerCase().includes(this.itemFilter.toLowerCase())
              )
            } else return this.todos
          },
          itemTotal: function () {
            return this.todos.length
          },
          filteredTotal: function () {
            return this.filteredItems.length
          },
        },
        watch: {
          newItem: function () {
            if (this.newItem.toLowerCase() === "clear") {
              this.todos.splice(0, this.todos.length)
              this.newItem = ""
              this.clearLabel = "To-do list cleared!"
            }
          },
          todos: function () {
            if (this.todos.length > 0)
              this.clearLabel =
                'Use the box below to add new list items, or type "Clear" to clear out the current list.'
          },
        },
        methods: {
          addItem: function () {
            if (this.newItem != "")
              this.todos.push({
                text: this.newItem,
                id: this.todos.length,
                edit: false,
              })
            this.newItem = ""
          },
          setItemEditable: function (item) {
            item.edit = true
            this.preEdit = item.text
          },
          editItem: function (item, index) {
            item.edit = false
            this.todos.splice(
              index,
              1,
              (item, { text: item, id: index, edit: false })
            )
          },
          resetEdit: function (item) {
            this.postEdit = item.text
            item.text = this.preEdit
            item.edit = false
          },
          deleteItem: function (item) {
            this.todos.splice(this.todos.indexOf(item), 1)
          },
        },
        directives: {
          focus: {
            inserted: function (el) {
              el.focus()
            },
          },
        },
      })
    </script>
  </body>
</html>
